## 异常

如果一个用户在运行程序期间，由于程序的错误或一些外部环境的英系那个造成用户数据的丢失，用户就有可能不再使用这个程序。为了避免这种事情的发生，至少应该做到以下几点：

- 向用户通告错误
- 保存所有的工作结果
- 允许用户以妥善的形式退出程序

为了能够在程序中处理异常情况，必须研究程序中可能会出现的错误和问题，以及哪类问题需要关注。

**1.用户输入错误**

**2.设备错误**

**3.物理限制**

**4.代码错误**

​	程序方法有可能无法正确执行。例如：方法可能返回一个错误的答案，或者错误地调用了其他的方法。计算的数组索引不合法，试图在散列表中查找一个不存在的记录，或者试图让一个空战执行弹出操作，这些都属于代码错误。

### 一、异常分类

异常对象都是派生于，Throwable类的一个实例。**所有的类都是由Throwable继承而来，**在下一层分解为两个分支：Error和Exception。

Error类层次结构描述了Java运行时系统的内部错误和资源耗尽错误。如果出现了这样的内部错误，除了通告给用户，并尽力使程序安全地终止以外，再也无能无力。

我们设计Java程序时，需要关注Exception层次结构。这个层次结构分解为两个分支：一个分支派生于RuntimeException；另一个分支包含其他异常。由于程序错误导致的异常属于RuntimeException，而程序本身没有问题，但由于像I/O错误的这类问题导致的异常属于其他异常。

**"如果出现RuntimeException异常，那么就一定是你的问题"**是一条相当有道理的规则。应该通过检测数组下标是否越界来避免ArrayIndexOutOfBoundsException异常；应该通过在使用变量之前检测是否为null来杜绝NullPointerException异常的发生。

### 二、捕获异常

捕获异常需要进行周密的计划。如果某个异常发生的时候没有在任何地方进行捕获，那程序就会终止执行。

想要捕获一个异常，必须设置try/catch语句块。最简单的try语句块如下所示：

```java
try{
  code;
  more code;
  more code;
}catch {
  handler for this type
}
```

如果try语句块中的任何代码抛出了一个在catch子句中说明的异常类，那么：

1）程序将跳过try语句块的其余代码

2）程序将执行catch子句中的处理器代码

如果在try语句块中的代码没有抛出任何异常，那么程序将跳过catch语句。

通常，最好的选择就是什么也不做，而是将异常传递给调用者。如果read方法出现了错误，就让read方法的调用者去操心！如果采用这种处理方式，就必须声明这个方法可能会抛出一个IOException。

```java
public void read(String filename)throws IOException
{
	InputStream in = new FileInputStream(filename);
	int b;
  while(b == in.read() != -1){
  	process input;
  }
}
```

如果调用了一个抛出受查异常的方法，就必须**对它进行处理，或者继续传递**。

通常，应该捕获那些知道如何处理的异常，而将那些不知道怎样处理的异常继续进行传递。

### 三、finally子句

当代码抛出一个异常时，就会终止方法中剩余代码的处理，并退出这个方法的执行。如果方法获得了一些本地资源，并且只有这个方法指导，有如果这些资源在退出方法之前必须被回收，那么就会产生资源回收问题。Java中如何恰当地关闭一个文件。当反生异常时，恰当的关闭所有数据库的连接是非常重要的。
不管是否有异常捕获，finally子句中的代码都将被执行。

```java
InputStream in = new FileInputStream(...);
try{
  code that might throw exception;
}
catch{
  show error message;
}
finally{
  in.close();
}
```

### 记录日志

记录日志API的特定：

- 很容易取消全部日志记录，或者仅仅取消某个级别的日志，而且打开和关闭这份操作都很容易
- 可以很简单的禁止日志记录的输出，因此，将这些日志代码留在程序中的开销很小
- 日志记录可以被定向到不同的处理器，用于在控制台中显示，用于存储在文件中等。
- 日志记录器和处理器都可以对记录进行过滤。过滤器可以根据过滤实现器制定的标准丢弃那些无用的记录项。
- 应用程序可以使用多个日志记录器，他们使用类似包名的这种具有层次结构的名字，例如，com.mycompany.myapp.
- 在默认情况下，日志系统的配置由配置文件控制。如果需要的话，应用程序可以替换这个配置。

日志说明书中一些最基本的操作：

1）为一个简单的应用程序，选择一个日志记录器，并把日志记录器命名为与主应用程序包一样的名字。例如：com.mycompany.myprog，这是一种良好的编程习惯。

2）默认的日志配置将级别等于或高于INFO级别的所有消息记录到控制台。用户可以覆盖默认的配置文件。但是改变配置需要做相当多的工作，因此，最后在应用程序中安装一个更加适宜的默认配置。

3）现在可以记录自己想要的内容了，但是需要牢记：**所有级别为INFO、WARNING和SEVERE的消息都将显示到控制台。**因此，最后只将对程序用户有意义的消息设置为这几个级别。当程序员想要的日志记录，设定为FINE是一个很好的选择。